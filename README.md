### ONJ 과제 프로젝트

#### 본 문서는 아래 항목들에 대해 기술하였으며, 각각의 항목은 `Doc` 폴더 하위에 항목별로 저장되어 있습니다.

- 프로젝트 실행 방법
- 프로젝트 동작 시나리오 및 설정
- 테스트 시나리오 문서
- DB 스키마 구조
- 사용한 주요 라이브러리
- 프로젝트 구조

### 프로젝트 실행 방법

1. 프로젝트 build 후 jar 파일 확인(build>libs>.jar)
2. DockerFile의 설정 값 확인(jdk 버전, jar파일 경로등...)
3.  `docker build -t template-manage:{Tag version} .`
 
	- Tag version는 도커 이미지의 Tag에 기록되는 값으로 식별하기 위한 값.
 
4.  `docker run -p 8080:8080 template-manage:{Tag version}`
 
 	- 빌드된 도커 이미지를 실행시키는 명령어로 현재 프로젝트의 경우 8080포트를 사용하기에 내부의 8080포트와 외부의 포트를 연결
 
 	- 포트 정보는 환경에 맞춰 사용

cf.) H2 DB의 경우 도커 내부에 사용되기에 application.properties에 추가 설정

	-  'spring.h2.console.settings.web-allow-others=true' 
 
	- 또한 컨테이너 변경 시 기존 DB 데이터가 삭제되기에 필요 시 관련 데이터 백업 후 사용.

### 프로젝트 동작 시나리오 및 설정

### 해당 프로그램은 템플릿 관리를 위한 프로그램입니다.

1. 사용자
   
	1-1. 모든 사용자는 자신의 계정을 등록하고 로그인 할 수 있습니다.
   
	1-2. 모든 사용자는 자신의 계정에 대한 비밀번호 변경 및 회원 탈퇴가 가능합니다.

2. 아이템

	2-1. 모든 사용자는 아이템 등록이 가능합니다.

	2-2. 아이템의 타입은 TEXT, CHECKBOX, DROPDOWN으로 고정 되어있으며 CHCEKBOX와 DROPDOWN 타입의 경우 추가 선택지 정보가 Json 형태로 필요합니다. 

	자세한 정보는 API문서를 참고 바랍니다.

	2-3. 사용자는 자신이 등록한 아이템만 조회가 가능합니다. 

		- 아이템명과 타입을 제공 받아 조건(아이템,타입,아이템+타입)에 해당하는 아이템을 조회 할 수 있습니다. 
		
		- 아이템 명의 경우 조건에 입력된 값을 포함(like 조건)하는 아이템을 전부 조회합니다.

		- 페이징 정보(page number,size)를 제공 받아 페이징 조건에 맞춰 조회됩니다.

	2-4. 사용자는 자신이 생성한 아이템만 수정할 수 있습니다. 

		- TEXT -> CHECKBOX,DROPDOWN 타입으로 변경 시 아이템 옵션값을 추가로 입력 받아 등록합니다.

		- CHECKBOX,DROPDOWN 타입 -> TEXT 타입으로 변경 시 연관된 아이템 옵션의 경우 소프트 삭제를 진행합니다.

		- CHECKBOX,DROPDOWN 타입 -> DROPDOWN,CHECKBOX 타입으로 변경 시 연관된 아이템 옵션의 경우 소프트 삭제 진행 후 전달 받은 데이터를 등록합니다.

	2-5. 사용자는 자신이 생성한 아이템을 삭제할 수 있습니다.

		- 아이템의 경우 상위 항목(컨텐츠,템플릿)에서 사용되기에 영향이 가지 않도록 소프트 삭제 방식으로 삭제가 가능합니다. 이는 데이터 삭제가 아닌 DB 상태값을 통해 삭제 여부 상태값 변경을 통해 적용됩니다. 
		- 연관된 아이템 옵션의 경우 마찬가지로 소프트 삭제가 적용됩니다.

3. 템플릿

	3-1. 모든 사용자는 템플릿 등록이 가능합니다.

		- 등록 시 AccessLevel을 설정합니다. 이는 PUBLIC, PRIVATE 두가지 옵션으로 고정됩니다.

		- 템플릿 정보와 템플릿에 등록되는 아이템 정보는 중간 테이블을 통해 관리합니다.

	3-2. 사용자는 자신이 등록했거나 PUBLIC 레벨로 설정되어 있는 템플릿을 조회 할 수 있습니다.

		- 템플릿명과 타입을 제공 받아 조건(템플릿명,타입,템플릿명+타입)에 해당하는 아이템을 조회 할 수 있습니다.

		- 페이징 정보(page number,size)를 제공 받아 페이징 조건에 맞춰 조회됩니다.

	3-3. 사용자는 자신이 등록한 템플릿만 수정할 수 있습니다.

		- 템플릿이 상위 항목(컨텐츠)에서 사용 중일때는 수정이 불가능합니다.

		- 템플릿에 연관된 아이템 정보의 경우 서비스 로직에 따라 관계 제거 후 재설정됩니다.

		- 수정이 가능한 템플릿의 경우 현재 연관된 컨텐츠가 없기에 변경 시 하위 아이템 관계를 서비스 로직에서 제거 후 재설정 할 수 있습니다.

	3-4. 사용자는 자신이 등록한 템플릿을 삭제할 수 있습니다.

		- 템플릿의 경우 상위 항목(컨텐츠)에서 사용되기에 영향이 가지 않도록 소프트 삭제 방식으로 삭제가 가능합니다. 
		- 이는 데이터 삭제가 아닌 DB 상태값을 통해 삭제 여부 상태값 변경을 통해 적용됩니다.

		- 중간 테이블(아이템과 템플릿의 연관 테이블)의 경우 삭제된 템플릿은 해당 관계에 변경이 없고 상위 항목(컨텐츠)에 영향을 주지 않도록 데이터를 유지합니다.

4. 컨텐츠

	4-1. 모든 사용자는 컨텐츠 등록이 가능합니다.

	4-2. 모든 사용자는 전체 컨텐츠 리스트를 조회 가능합니다.

	4-3. 컨텐츠 리스트를 통해 원하는 리스트의 세부 정보 조회가 가능합니다.

	4-4. 사용자는 자신이 등록한 컨텐츠만 수정이 가능합니다.

		- 변경된 템플릿에 따라 아이템 입력값을 전달 받아 수정합니다.

	4-5. 사용자는 자신이 등록한 컨텐츠를 삭제할 수 있습니다.

		- 컨텐츠는 최상위 항목으로 데이터 삭제가 진행됩니다.

*로그인과 회원가입을 제외한 기능은 JWT 인증을 통한 토큰 발급이 필요합니다.

### 테스트 문서 
### ( 예상 결과 값을 포함한 정규 문서 작성은 하지 못하여 전체 테스트 과정 시나리오를 작성하여 전달드립니다. 참고부탁드립니다.)

1. 회원가입

2. 로그인 

3. 회원정보 변경 

4. 회원 탈퇴 

5. 아이템 등록

	- TEXT, CHECKBOX, DROPDOWN 3가지 타입 모두 등록을 진행합니다.

6. 아이템 조회

	6-1. 등록한 유저의 ID 정보만 입력하여 조회
   
		- 본인이 등록한 아이템 확인
   
	6-2. 아이템명을 입력하여 조회(like)
   
		- 본인이 등록했고 입력한 아이템명을 포함하는 아이템 확인
   
	6-3. 아이템 타입을 입력하여 조회
   
		- 본인이 등록했고 입력한 타입의 아이템 확인
   
	6-4. 아이템명, 아이템 타입을 입력하여 조회
   
		- 본인이 등록했고 입력한 아이템명을 포함하고 아이템 타입이 일치하는 아이템 확인
			 
7. 아이템 정보 변경

	7-1. 아이템 타입 변경(TEXT -> CHECKBOX, DROPDOWN)시 아이템 옵션값 추가 등록
   
		- DB 데이터 변경 확인
   
	7-2. 아이템 타입 변경(CHCEKBOX, DROPDOWN -> TEXT)시 아이템 옵션 소프트 삭제
   
		- DB 데이터 변경 확인, 아이템 옵션의 삭제 상태값 변경 확인
   
	7-3. 아이템 타입 변경(CHCEKBOX, DROPDOWN -> DROPDOWN, CHCEKBOX)시 아이템 옵션 소프트 삭제, 추가 등록
   
		- DB 데이터 변경 확인, 아이템 옵션의 삭제 상태값 변경 확인
   
	7-4. 7번의 모든 과정에 대해 등록 유저가 아닌 유저로 테스트
   
		- 정상 동작 실패 확인
   
8. 아이템 삭제

	8-1. 아이템 삭제 시 아이템,아이템 옵션 소프트 삭제
    
	8-2. 8번의 모든 과정에 대해 등록 유저가 아닌 유저로 테스트

 		- 정상 동작 실패 확인
 
9. 템플릿 등록

	9-1. AccessLevel 2가지(PUBLIC, PRIVATE) 모두 등록을 진행합니다.

10. 템플릿조회

	10-1. 등록한 유저의 ID 정보만 입력하여 조회
    
		- 본인이 등록한 템플릿과 AccessLevel PUBLIC인 템플릿 확인
    
	10-2. 템플릿명 입력하여 조회
    
		- 본인이 등록했고 PUBLIC이면서 입력한 템플릿 명을 포함하는 템플릿 확인
    
	10-3. 템플릿 타입을 입력하여 조회
    
		- 본인이 등록했고 PUBLIC이면서 입력한 템플릿 타입인 템플릿 확인
    
	10-4. 템플릿명, 템플릿 타입을 입력하여 조회
    
		- 본인이 등록했고 PUBLIC이면서 입력한 템플릿 명을 포함하고 템플릿 타입인 템플릿 확인

11. 템플릿 변경

	11-1. 템플릿 정보 변경
    
	11-2. 상위 항목(컨텐츠) 생성 후 컨텐츠와 연관텐 템플릿 변경 요청
    
		- 정상 동작 실패 확인
    
	11-3. 11번의 모든 과정에 대해 등록 유저가 아닌 유저로 테스트
    
		 - 정상 동작 실패 확인
 
12. 템플릿 삭제

	12-1. 템플릿 삭제 시 템플릿 소프트 삭제 

	12-2. 12번의 모든 과정에 대해 등록 유저가 아닌 유저로 테스트

		- 정상 동작 실패 확인
 
13. 컨텐츠 등록

	13-1. 컨텐츠 등록

	13-2. 등록시 연관된 템플릿 변경 불가 확인(11-2번으로 확인)

14. 컨텐츠 리스트 조회

15. 컨텐츠 조회
 
16. 컨텐츠 수정

	16-1. 컨텐츠 정보 수정

	16-2. 16번의 모든 과정에 대해 등록 유저가 아닌 유저로 테스트

		- 정상 동작 실패 확인

17. 컨텐츠 삭제

	17-1. 컨텐츠 삭제

	17-2. 17번의 모든 과정에 대해 등록 유저가 아닌 유저로 테스트

		- 정상 동작 실패 확인

18. 모든 api에 대해 jwt 토큰 제거 후 재시도

	- 정상 동작 실패 확인


### DB 스키마 구조

- 관련 데이터의 경우 백업 SQL파일과 프로젝트 H2 임베디드 파일을 /doc/DB 경로에 저장해두었습니다.

- /doc/DB/DB_DATA_TABLE_BACKUP : 테스트 데이터 포함 SQL 파일과 H2 임베디드 DB 파일

- /doc/DB/DB_NO_DATA_TABLE_BACKUP : 테스트 데이터 미포함 SQL 파일과 H2 임베디드 DB 파일

### 사용한 주요 라이브러리

## 라이브러리 목록

- Spring Security, JWT, QueryDSL, Swagger, Lombok, H2, JPA

Lombok : 다양한 데이터를 사용함에 있어 getter,setter를 비롯한 반복적으로 사용되는 코드를 줄이기 위해 사용

JPA,H2 : 과제의 구현을 위한 JPA 적용과 인메모리 DB로 H2를 선택하였기에 사용

Swaager : API 문서 작성 위한 라이브러리로 Swagger가 지정되었기에 사용. 
	  이때 Spring Doc을 사용했으며 Spring Fox의 업데이트 중단이 지속되기에 Spring Doc 채택.

JWT,Spring Security : 과제의 선택 사항으로 JWT 기반 인증 및 인가가 제시되어 사용.

QueryDSL : 필요 기능 중 DB에 접근하여 다양한 필터 조건을 통한 결과값 추출이 필요한 상황에서 기본 JPA 문법으로 구현하게되면 코드가 복잡해지고 분기가 많아지며 데이터의 변화에 유연하게 대응하기 힘든다는 판단으로 사용하게되었음.

### 프로젝트 구조

├────────────────────────────────────────────────────────────────────────────────────

├─java

│  └─com

│      └─onj

│          └─template_manage

│              ├─config               # Configration 설정 파일

│              ├─controller           # 뷰로부터 오는 요청 처리

│              ├─DTO				  # 요청/응답 처리를 위한 DTO 파일

│              │  ├─Request           # 요청 DTO

│              │  │  ├─content        

│              │  │  ├─item           

│              │  │  ├─template       

│              │  │  └─user           

│              │  └─Response          # 응답 DTO

│              │      ├─content       

│              │      ├─Item          

│              │      ├─template      

│              │      └─user          

│              ├─entity               # DB 테이블과 맵핑하는 Entitiy 파일

│              ├─exception            # 익셉션 처리를 위한 파일

│              │  ├─content           

│              │  ├─Item              

│              │  ├─template          

│              │  └─user              

│              ├─jwt                  # JWT 적용을 위한 설정 파일

│              ├─repository           # DB에 접근하여 데이터 취득하는 Repository 파일

│              └─service              # Controller를 통한 비즈니스 로직 처리 

└────────────────────────────────────────────────────────────────────────────────────





